# 06. 프락시

## 6.0 Intro

- 웹 프락시 서버는 중개자이다.
- 프락시는 클라이언트와 서버 사이에 위치하여 그들 사이의 HTTP 메시지를 정리하는 중개인

<br>

## 6.1 웹 중개자

- 웹 프락시 서버는 클라이언트의 입장에서 트랜잭션을 수행하는 중개인
- 웹 프락시가 없다면, 클라이언트는 HTTP 서버와 직접 이야기한다.
- 웹 프락시가 있다면, 프락시와 이야기한다.
- HTTP 프락시 서버는 웹 서버이기도 하고 웹 클라이언트이기도 하다.

<br>

### 6.1.1 개인 프락시와 공유 프락시

- **개인 프락시**: 하나의 클라이언트만을 위한 프락시
- **공용 프락시**: 여러 클라이언트가 함께 사용하는 프락시

<br>

### 6.1.2 프락시 VS 게이트웨이

- **프락시**: 같은 프로토콜을 사용하는 둘 이상의 애플리케이션을 연결
- **게이트웨이**: 서로 다른 프로토콜을 사용하는 둘 이상을 연결

> <img src="https://blog.kakaocdn.net/dn/rqpkr/btqDfBWr0JK/1guakJKsyRwEkeMmN3K6Y1/img.png" width="400">

<br>

## 6.2 왜 프락시를 사용하는가?

- 프락시 서버는 보안을 개선하고, 성능을 높여주며, 비용을 절약한다.
- 모든 HTTP 트래픽을 들여다보고 건드릴 수 있다.
- ex. **부적절한 사이트 접근 필터, 문서 접근 제어자, 보안 방화벽, 웹 캐시, 대리 프락시, 콘텐츠 라우터, 트랜스코더, 익명화 프락시**

<br>

## 6.3 프락시는 어디에 있는가?

**1. 어떻게 프락시가 네트워크에 배치되는가**

- 출구 프락시

  - 트래픽을 제어하기 위해 로컬 네트워크의 출구에 넣는다.

- 접근(입구) 프락시

  - 고객으로부터의 모든 요청을 종합적으로 처리하기 위해 ISP 접근 지점에 위치한다.

- 대리 프락시

  - 네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치한다.

- 네트워크 교환 프락시

  - 네트워크 사이의 인터넷 피어링 교환 지점들에 놓인다.

<br>

**2. 어떻게 프락시의 연쇄가 계층을 이루는가**

- 프락시 계층에서 프락시 서버들은 부모와 자식의 관계를 갖는다.
- 접근 프락시는 상황에 맞게 부모 프락시나 원 서버에게 라우팅한다.
- 동적 부모 선택의 예
  - 부하 균형
  - 지리적 인접성에 근거한 라우팅
  - 프로토콜/타입 라우팅
  - 유료 서비스 가입자를 위한 라우팅

<br>

**3. 어떻게 프락시가 트래픽을 처리하는가**

- 클라이언트 트래픽이 프락시로 가도록 만드는 방법
  - 클라이언트를 수정한다.
  - 네트워크를 수정한다.
  - DNS 이름공간을 수정한다.
  - 웹 서버를 수정한다.

<br>

## 6.4 클라이언트 프락시 설정

**프락시를 설정하는 여러 방법**

- 수동 설정
  - 프락시의 호스트와 포트를 지정한다.
- PAC 파일 설정
  - 문서에 접근할 때마다 자바스크립트 함수가 적절한 프락시 서버를 선택한다.
- WPAD 설정
  - 여러 발견 메커니즘들의 상승 전략을 이용해 브라우저에게 알맞은 PAC 파일을 자동으로 찾아주는 알고리즘이다.

<br>

## 6.5 프락시 요청의 미묘한 특징들

- 프락시 URI는 서버 URI와 다르다.
- 프락시의 '스킴/호스트/포트번호 누락' 문제는 가상으로 호스팅 되는 웹 서버가 직면한 것과 같은 문제이다.
- 인터셉트 프락시는 부분 URI를 받는다.
- 프락시는 프락시 요청과 서버 요청을 모두 다룰 수 있다.
- 프락시 서버는 요청 URI의 변경에 매우 신경을 써야 한다.
- 브라우저는 프락시의 존재 여부에 따라 요청 URI를 다르게 분석한다.
- 브라우저는 유효한 호스트 명이 발견될 때까지 다양한 호스트 명의 가능성들을 검색한다.
- 명시적인 프락시를 사용한다면 브라우저의 URI가 프락시를 그냥 지나쳐버린다.
- 보이지 않는 인터셉트 프락시를 사용한다면 호스트 명 분석이 약간 달라진다.

<br>

## 6.6 메시지 추적

- 프락시가 점점 흔해지면서, 프락시를 넘나드는 메시지의 흐름을 추적하고 문제점을 찾아내는 것도 필요한 일이 되었다.

**Via 헤더**

- Via 헤더 필드는 메시지가 지나는 각 중간 노드의 정보를 나열한다.

**Server 헤더**

- Server 응답 헤더 필드는 원 서버에 의해 사용되는 소프트웨어를 알려준다.

**TRACE 메서드**

- 요청 메시지를 프락시의 연쇄를 따라가면서 어떤 프락시를 지나가고 어떻게 각 프락시가 요청 메시지를 수정하는지 관찰/추적할 수 있도록 해준다.

**Max-Forwards 헤더**

- 전달되는 메시지가 무한 루프에 빠지지 않는지 프락시 연쇄를 테스트하거나 연쇄 중간의 특정 프락시 서버들의 효과를 체크한다.

<br>

## 6.7 프락시 인증

- 프락시는 접근 제어 장치로서 제공될 수 있다.

<br>

## 6.8 프락시 상호운용성

**지원하지 않는 헤더와 메서드 다루기**

- 프락시는 이해할 수 없는 헤더 필드는 반드시 그대로 전달해야 한다.
- 같은 이름의 헤더 필드가 여러 개 있는 경우에는 그들의 상대적인 순서도 반드시 유지해야 한다.

<br>

**OPTIONS: 어떤 기능을 지원하는지 알아보기**

- HTTP OPTIONS 메서드는 서버나 웹 서버의 특정 리소스가 어떤 기능을 지원하는지 클라이언트가 알아볼 수 있게 해준다.

<br>

**Allow 헤더**

- Allow 엔터티 헤더 필드는 요청 URI에 의해 식별되는 자원에 대해 지원되는 메서드들이나 서버가 지원하는 모든 메서드를 열거한다.
