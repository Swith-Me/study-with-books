# 04. 커넥션 관리

✔ HTTP는 어떻게 TCP 커넥션을 사용하는가

✔ TCP 커넥션의 지연, 병목, 막힘

✔ 병렬 커넥션, keep-alive 커넥션, 커넥션 파이프라인을 활용한 HTTP의 최적화

✔ 커넥션 관리를 위해 따라야 할 규칙들 

### 4.1 TCP 커넥션

**📝 전 세계 모든 HTTP 통신은, TCP/IP를 통해 이루어진다.**

- 세계 어디서든 클라이언트 애플리케이션은 서버 애플리케이션으로 TCP/IP 커넥션을 맺을 수 있다.

**4.1.1 신뢰할 수 있는 데이터 전송 톨로인 TCP** 

- HTTP 커넥션은 몇몇 사용 규칙을 제외하고는 TCP 커넥션에 불과하다.
- TCP는 충돌 없이 순서에 맞게 HTTP 데이터를 전달한다.

**4.1.2 TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다.**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3e7a9163-98cc-4140-a425-b26ad6a69c98/Untitled.png)

- IP 패킷이 포함하는 것
- IP 패킷 헤더 (보통 20바이트)
- TCP 세그먼트 헤더 (보통 20바이트)
- TCP 데이터 조각 (0 혹은 그 이상의 바이트)

**4.1.3 TCP 커넥션 유지하기**

<발신지 IP 주소, 발신지 포트, 수신지 IP 주소, 수신지 포트>

이 네 가지 값으로 유일한 커넥션을 생성한다. 

**4.1.4 TCP 소켓 프로그래밍** 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/669c75b1-e6c7-4d26-be33-90b3ca99b1c5/Untitled.png)

### **4.2 TCP의 성능에 대한 고려**

HTTP는 TCP 바로 위에 있는 계층이기 때문에 HTTP 트랜잭션의 성능은 그 아래 계층인 TCP 성능에 영향을 받는다. 

**4.2.1 HTTP 트랜잭션 지연**

트렌잭션을 처리하는 시간은 TCP 커넥션을 설정하고, 요청을 전송하고, 응답 메시지를 보내는 것에 비하면 상당히 짧다는 것을 알 수 있다. 

1. 클라이언트는 URI에서 웹 서버의 IP 주소와 포트 번호를 알아내야 한다.
2. 다음으로, 클라이언트는 TCP 커넥션 요청을 서버에게 보내고 서버가 커넥션 허가 응답을 회신하기를 기다린다.

**4.2.2 성능 관련 중요 요소**

TCP 커넥션의 핸드셰이크 설정

인터넷의 혼잡을 제어하기 위한 TCP의 느린 시작(SLOW-START)

데이터를 한데 모아 한 번에 전송하기 위한 네이글 알고리즘 

TCP 편승 확인응답을 위한 확인응답 지연 알고리즘

TIME_WAIT 지연과 포트 고갈

### 4.3 HTTP 커넥션 관리

**4.3.1 흔히 잘못 이해하는 Connection 헤더**

- HTTP 헤더 필드 명은, 이 커넥션에만 해당되는 헤더들을 나열한다.
- 임시적인 토큰 값은, 커넥션에 대한 비표준 옵션을 의미한다.
- CLOSE 값은, 커넥션이 작업이 완료되면 종료되어야 함을 의미한다.

**4.3.2 순차적인 트랜잭션 처리에 의한 지연**

- 병렬 커넥션
    - 여러 개의 TCP 커넥션을 통한 동시 HTTP 요청
- 지속 커넥션
    - 커넥션을 맺고 끊는 데서 발생하는 지연을 제거하기 위한 TCP 커넥션의 재활용
- 파이프라인 커넥션
    - 공유 TCP 커넥션을 통한 병렬 HTTP 요청
- 다중 커넥션
    - 요청과 응답을에 대한 중재 (실험적인 기술이다.)

###
