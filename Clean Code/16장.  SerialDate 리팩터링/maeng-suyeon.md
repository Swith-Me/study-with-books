**SerialDate 란?**

-   이를 구현한 사람은 데이비드 길버트; David Gilbert다.
-   이는 날짜를 표현하는 자바 클래스다.

<br>

## 첫째, 돌려보자

SerialDateTests라는 클래스는 단위 테스트 케이스 몇 개를 포함한다.

돌려보면 실패하는 테스트 케이스는 없지만, 이를 훑어보면 모든 경우를 점검하지 않는다는 사실이 드러난다.

-   많은 코드가 주석 처리 되어있고, 이는 실패한 테스트 케이스이다.
-   하지만, 실행 가능한 문장 185개 중, 170개를 실행하여 코드 커버리지가 대략 92%에 이른다.

<br>

## 둘째, 고쳐보자

`SerialDate` 코드를 처음부터 짚어가며 하나씩 고쳐나갈 때마다 `JCommon` 단위 테스트와 구현한 단위 테스트를 실행했다.

클래스 이름에 `'Serial'`이 들어가는 이유는

1. `SERIAL_LOWER_BOUND`와 `SERIAL_UPPER_BOUND`라는 상수
2. '일련번호; serial number'를 사용해 클래스 구현

이렇게 두 가지 단서로 추측해 알아냈다.

많은 수정 작업을 거친 후 고쳐본 작업을 정리해보자면,

1. 처음에 나오는 주석은 너무 오래되어서, 간단하게 고치고 개선했다.
2. `enum`을 모두 독자적인 소스 파일로 옮겼다.
3. 정적 변수(`dateFormatSymbols`)와 정적 메서드(`getMonthNames`, `isLeapYear`, `lastDayOfMonth`)를 `DateUtil` 이라는 새 클래스로 옮겼다.
4. 일부 추상 메서드를 `DayDate`(`=SerialDate`) 클래스로 끌어올렸다.
5. `Month.make`를 `Month.fromInt`로 변경하고, 다른 `enum`도 똑같이 변경했다. 또한 모든 `enum`에 `toInt()` 접근자를 생성하고 `index` 필드를 `private`로 정의했다.
6. `plusYears`와 `plusMonths`에 흥미로운 중복이 있어 `correctLastDayOfMonths`라는 새 메서드를 생성해 중복을 없앴다. 그래서 세 메서드가 모두 좀 더 명확해졌다.
7. 팔방미인으로 사용하던 숫자 1을 없애고, 모두 `Month.JANUARY.toInt()` 혹은 `Day.SUNDAY.toInt()`로 적절히 변경하고, `SpreadsheetDate` 코드를 살펴보고 알고리즘을 조금 손봤다.

이렇게 하여 `DayDate` 코드 커버리지는 84.9%로 감소했다.

그 이유는 테스트하는 코드가 줄어서가 아닌, 클래스 크기가 작아져서 테스트하지 않는 코드의 비중이 커져서 그렇다.

<br>

## 결론

-   보이스카우트 규칙을 따라 체크아웃한 코드보다 좀 더 깨끗한 코드를 체크인하게 되었다.
-   테스트 커버리지가 증가하고, 버그 몇 개를 수정하고, 코드 크기가 감소했고, 코드가 명확해졌다.
