# 📒 16장. SerialDate 리팩터링

[jcommon](http://www.jfree.org/jcommon/index.php)에서 ```JCommon``` 라이브러리 ```org.jfree.date``` 패키지에 ```SerialDate```라는 클래스가 있다

<br />

## 첫째, 돌려보자

클로버에 따르면, SerialDate에서 실행 가능한 문장 185개 중 단위 테스트가 실행하는 문장은 91개에 불과했다 (대략 50%)

독자적으로 단위 테스트 케이스를 구현한 결과 (코드 커버리지 약 92%), 실패한 테스트 케이스들도 있었다   
SerialDate를 리팩터링하면서 모든 테스트 케이스를 통과하게 코드를 손 볼 작정이다

<br />

## 둘째, 고쳐보자

한 작업을 정리해보면

1. 처음에 나오는 주석은 너무 오래되었다   
간단하게 고치고 개선했다

2. enum을 모두 독자적인 소스 파일로 옮겼다   
리팩터링 과정 중 크기가 커졌다

3. 정적 변수```dateFormatSymbols```와 정적 메서드```getMonthNames, isLeapYear, lastDayOfMonth```를 ```DateUril```이라는 새 클래스로 옮겼다

4. 일부 추상 메서드를 DayDate 클래스로 끌어올렸다

5. ```Month.make```를 ```Month.fromInt```로 변경했다   
다른 enum도 마찬가지다   
모든 enum에 ```toInt()``` 접근자를 생성하고 ```index``` 필드를 private로 정의했다

6. ```plusYears```와 ```plusMonths```에 중복을 ```LastDayOfMonth```라는 새 메서드를 생성해 없앴다

7. 팔방미인으로 사용되던 숫자 1을 없앴다   
```Month.JANUARY.toInt()```, ```Day.SUNDAY.toInt()```로 적절히 변경했다   

8. SpreadsheetDate 코드를 살펴보고 알고리즘을 조금 손봤다

```512쪽 목록 B-17```에 결과 코드가 있다

<br />

흥미롭게도 DayDate 코드 커버리지는 92%에서 84.9%로 감소했다   
테스트하는 코드가 줄어서가 아닌, 클래스 크기가 작아지는 바람에 테스트하지 않는 코드의 비중이 커졌기 때문이다

<br />

## 결론

1. 테스트 커버리지가 증가했다
2. 버그 몇 개를 고쳤다
3. 코드 크기가 줄었다
4. 코드가 명확해졌다
5. 다음 사람은 우리보다 코드를 좀 더 쉽게 이해할 것이다

<br />

## 기억에 남은 부분

> _다음 사람은 우리보다 코드를 좀 더 쉽게 이해하리라. 그래서 우리보다 코드를 좀 더 쉽게 개선하리라._
