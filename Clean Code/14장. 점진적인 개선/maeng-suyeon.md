이 챕터는 점진적인 개선을 보여주는 사례 연구다.

출발은 좋았으나 확장성이 부족했던 모듈 → 모듈 개선 후 정리하는 단계를 살펴볼 것이다.

프로그램을 구현하다 보면, 종종 명령행 인수의 구문을 분석할 필요가 생긴다.

편리한 유틸리티가 없다면 `main` 함수로 넘어오는 문자열 배열을 직접 분석하게 된다.

그러나 여러 가지 훌륭한 유틸리티가 있지만, 내 사정에 딱 맞는 유틸리티가 없다면?

그러면 직접 구현해야 될 것이고, 이 유틸리티를 `Args`라 부르겠다.

`Args`의 사용법

1. `Args` 생성자에 (입력으로 들어온) 인수 문자열과 형식 문자열을 넘겨 `Args` 인스턴스 생성
2. `Args` 인스턴스에다 인수 값 질의

<br>

## Args 구현

예제 코드를 보며 여기저기 뒤적일 필요 없이 위에서 아래로 코드가 읽힌다는 사실과 이름을 붙인 방법, 함수 크기, 코드 형식에 주목하자.

많은 예제 코드처럼 단순한 개념을 구현하는데 코드가 너무 많이 필요해 놀랄 수도 있다.

왜냐하면 우리가 장황한 언어인 자바를 사용하기 때문에 많은 단어가 필요해서 그렇다.

루비, 파이썬, 스몰토크 등과 같은 언어를 사용했다면, 프로그램이 훨씬 작아졌을탠데...

<br>

### 어떻게 짰느냐고?

지난 수십여 년 동안 쌓아온 경험에서 얻은 교훈으로, 프로그래밍은 과학보다 공예; craft에 가깝다는 사실이다.

⇒ 깨끗한 코드를 짜려면 먼저 지저분한 코드를 짠 뒤에 정리해야 한다는 의미다.

<br>

## Args: 1차 초안

인스턴스 변수 개수가 압도적이고, `'TILT'`와 같은 희한한 문자열, `HashSets`와 `TreeSets`, `try-catch-catch` 블록 등 지저분한 코드가 대다수다.

<br>

### 그래서 멈췄다

추가할 인수 유형이 적어도 두 개는 더 있었지만, 그러면 코드가 훨씬 더 나빠지기 때문에 더 이상 추가하지 않고, 리팩터링을 시작했다.

왜냐하면 코드 구조를 유지보수하기 좋은 상태로 만들려면 지금이 적기라 판단했기 때문이다.

-   리팩터링 단계
    1. 인수 유형에 해당하는 `HashMap`을 선택하기 위해 스키마 요소의 구문을 분석하고,
    2. 명령행 인수에서 인수 유형을 분석해 진짜 유형으로 변환하고,
    3. `getXXX` 메서드를 구현해 호출자에게 진짜 유형을 반환했다.

<br>

### 점진적으로 개선하다

프로그램을 망치는 가장 좋은 방법 중 하나는 개선이라는 이름 아래 구조를 크게 뒤집는 행위다.

어떤 프로그램은 그저 그런 '개선'에서 결코 회복하지 못한다.

'개선' 전과 똑같이 프로그램을 돌리기가 아주 어렵기 때문이다.

그래서 **테스트 주도 개발; TDD**이라는 기법을 사용해 언제 어느 때라도 시스템이 돌아간다는 원칙을 적용했다.

**TDD**는 시스템을 망가뜨리는 변경을 허용하지 않아 변경을 가한 후에도 시스템이 변경 전과 똑같이 돌아가야 된다.

이 사실을 확인하려면 **자동화된 테스트 슈트**가 필요하다.

앞서 `Args` 클래스를 구현하는 동안 단위 테스트 슈트와 인수 테스트를 만들어 놓았기에 이를 이용해 테스트를 하였다.

<br>

## String 인수

`String` 인수를 추가하는 과정은 `boolean` 인수와 매우 유사했다.

`HashMap`을 변경하고 `parse`, `set`, `get` 함수를 고쳤다.

이외에도 상당한 코드를 `Args` 클래스에서 `ArgsException` 클래스로 옮기고, 모든 `ArgumentMarshaler` 클래스도 각자 파일로 옮겼다.

-   소프트웨어 설계는 분할만 잘해도 품질이 크게 높아진다.
-   적절한 장소를 만들어 코드만 분리해도 설계가 좋아진다.
-   관심사를 분리하면, 코드를 이해하기 보수하기 훨씬 더 쉬워진다.

<br>

## 결론

-   돌아가는 코드가 심하게 망가지는 사례는 흔해 그저 돌아가는 코드만으로는 부족하다.
    -   단순히 돌아가는 코드에 만족하는 프로그래머는 전문가 정신이 부족하다.
-   나쁜 코드를 깨끗한 코드로 개선할 수 있지만, 처음부터 깨끗한 코드로 유지하기가 상대적으로 더 쉽다.
-   그러므로 코드는 언제나 최대한 깔끔하고, 단순하게 정리하자. 절대로 썩어가게 방치하면 안 된다.
